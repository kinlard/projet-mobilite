﻿<!-- Déclaration du type de document HTML5 pour garantir la compatibilité navigateur -->
<!DOCTYPE html>
<!-- Définition de la langue principale du site en français pour l'accessibilité et le référencement -->
<html lang="fr">
<head>
    <!-- Encodage des caractères en UTF-8 pour afficher correctement les accents et emojis -->
    <meta charset="UTF-8">
    <!-- Configuration responsive : adaptation automatique mobile, désactivation du zoom pour une expérience contrôlée -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Titre affiché dans l'onglet du navigateur -->
    <title>Eco-Escapade | Carte Interactive</title>
    <!-- Icône du site (favicon) affichée dans l'onglet, utilise un emoji feuille encodé en SVG -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>%F0%9F%8C%BF</text></svg>">
    
    <!-- Chargement des styles de Leaflet : bibliothèque JavaScript open-source pour créer des cartes interactives -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Styles pour le regroupement automatique des marqueurs : évite la surcharge visuelle quand il y a beaucoup de gares -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <!-- Thème visuel par défaut des clusters de marqueurs -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <!-- Styles pour la mini-carte de navigation qui apparaît en coin d'écran -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.css" />
    <!-- Bibliothèque Font Awesome : fournit des milliers d'icônes vectorielles pour les boutons et l'interface -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Police Inter de Google : typographie moderne et lisible pour tout le texte du site -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <!-- Bibliothèque Canvas Confetti : génère une animation de confettis quand on ajoute une gare en favori -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    
    <!-- Feuille de style principale contenant tous les designs visuels -->
    <link rel="stylesheet" href="style.css">
    <!-- Feuille de style responsive : adapte l'affichage pour mobile et tablette -->
    <link rel="stylesheet" href="responsive.css">
</head>
<!-- Début du corps de la page HTML -->
<body>

    <!-- Écran de chargement visible au démarrage : masque la page pendant la récupération des données de l'API -->
    <div id="map-loader">
        <!-- Icône de vélo animée pour indiquer le chargement en cours -->
        <i class="fa-solid fa-bicycle bike-loader"></i>
        <!-- Barre de progression visuelle qui se remplit progressivement -->
        <div class="loading-bar-container"><div class="loading-bar" id="loadBar" style="width: 100%;"></div></div>
        <!-- Message textuel indiquant ce qui est en cours de chargement -->
        <p class="loading-text" id="loader-msg">Chargement de la carte...</p>
    </div>

    <!-- Fenêtre de tutoriel interactif : explique le fonctionnement du site aux nouveaux visiteurs en 4 étapes -->
    <div id="tutoBox" class="tuto-box">
        <!-- Titre de l'étape actuelle du tutoriel -->
        <div id="tutoTitle" class="tuto-title">TUTORIEL</div>
        <!-- Zone de texte contenant l'explication de l'étape en cours -->
        <div id="tutoText" class="tuto-text"></div>
        <!-- Bouton pour passer à l'étape suivante, déclenche la fonction nextTutoStep -->
        <button id="tutoBtn" class="tuto-btn" onclick="nextTutoStep()">SUIVANT ➡️</button>
        <!-- Bouton pour ignorer le tutoriel et accéder directement à la carte -->
        <button class="tuto-skip-btn" onclick="skipTuto()">Passer le tuto</button>
    </div>

    <!-- Barre de navigation supérieure : visible uniquement sur écran large (ordinateur et tablette) -->
    <div class="dashboard-header">
        <!-- Logo du site cliquable -->
        <div class="brand"><h1>Eco-Escapade</h1></div>
        <!-- Bouton menu hamburger : apparaît uniquement sur mobile, initialement masqué -->
        <button class="burger-menu" id="burgerMenu" style="display: none;">
            <!-- Les 3 barres horizontales du menu hamburger -->
            <span></span>
            <span></span>
            <span></span>
        </button>
        <!-- Liens de navigation vers les autres pages -->
        <div class="nav-links" id="navLinks">
            <!-- Retour vers la page d'accueil -->
            <a href="index.html" id="nav-home">Accueil</a>
            <!-- Accès au carnet de voyage avec les gares favorites -->
            <a href="carnet.html" id="nav-fav">Mes favoris</a>
            <!-- Informations sur le projet -->
            <a href="apropos.html" id="nav-apropos">À propos</a>
        </div>
        <!-- Barre de recherche permettant de trouver rapidement une gare par son nom -->
        <div class="search-container" id="searchBox">
            <!-- Icône de loupe pour identifier visuellement la fonction de recherche -->
            <i class="fa-solid fa-search search-icon"></i>
            <!-- Champ de saisie avec auto-complétion : suggère les gares correspondantes pendant la frappe -->
            <input type="text" id="search-input" list="gares-list" placeholder="Rechercher..." autocomplete="off">
            <!-- Liste des suggestions de gares, remplie dynamiquement par JavaScript -->
            <datalist id="gares-list"></datalist>
        </div>
        <!-- Groupe de boutons d'outils et d'actions situés à droite de la barre de navigation -->
        <div class="actions">
            <!-- Bouton découvrir : ouvre un assistant de recommandation de destinations (mer, montagne, ville...) -->
            <button class="btn-discover" onclick="openDiscoverModal()"><i class="fa-solid fa-compass"></i> <span id="btn-discover-text">DÉCOUVRIR</span></button>
            <!-- Bouton statistiques : affiche un tableau de bord avec les données nationales (nombre de gares, scores moyens...) -->
            <button id="btnStats" class="btn-discover" style="background: linear-gradient(135deg, #3b82f6, #2563eb); margin-right: 5px;"><i class="fa-solid fa-chart-column"></i> STATS</button>
            <!-- Bouton de géolocalisation : centre la carte sur la position GPS de l'utilisateur -->
            <button class="btn-tool" title="Me Localiser" onclick="locateUser()"><i class="fa-solid fa-location-arrow"></i></button>
            <!-- Bouton gare aléatoire : sélectionne et affiche une gare au hasard sur la carte -->
            <button id="btnRandomGare" class="btn-tool" title="Gare Aléatoire" onclick="randomGare()"><i class="fa-solid fa-dice"></i></button>
            
            <!-- Bouton carte de chaleur : affiche les zones de forte densité de gares (fonctionnalité masquée par défaut) -->
            <button id="btnHeatmap" class="btn-tool" onclick="toggleHeatmap()" title="Carte de chaleur affluence" style="display:none;">
                <i class="fa-solid fa-fire"></i>
            </button>
            <!-- Bouton carte IGN : bascule vers la vue topographique de l'Institut Géographique National -->
            <button id="btnIgn" class="btn-tool" onclick="toggleIgnLayer()" title="Carte topographique IGN">
                <i class="fa-solid fa-mountain"></i>
            </button>
            <!-- Bouton sélecteur de thème : permet de changer les couleurs du site (Eco-Vert, Océan...) -->
            <button id="btnThemes" class="btn-tool" onclick="openThemeSelector()" title="Changer le thème">
                <i class="fa-solid fa-palette"></i>
            </button>
            <!-- Bouton informations écologiques : affiche des données complémentaires (qualité de l'air, biodiversité...) -->
            <button id="btnEcoInfo" class="btn-tool" onclick="toggleEcoPanel()" title="Infos écologiques avancées">
                <i class="fa-solid fa-leaf"></i>
            </button>

            <!-- Bouton de changement de langue : bascule entre français et anglais -->
            <button class="lang-switch" onclick="switchLangMap()">FR / EN</button>
        </div>
    </div>

    <!-- HEADER MOBILE : 2 ÉTAGES (visible uniquement <768px) -->
    <!-- Barre de navigation spécifique pour les smartphones : se déploie sur 2 lignes pour optimiser l'espace -->
    <div class="mobile-header" id="mobileHeader">
        <!-- ÉTAGE 1 : Logo + Recherche -->
        <!-- Première ligne : logo et barre de recherche, les éléments prioritaires -->
        <div class="mobile-header-top">
            <!-- Logo réduit du site -->
            <div class="mobile-logo">
                <h1>Eco-Escapade</h1>
            </div>
            <!-- Barre de recherche adaptée au tactile, plus large sur mobile -->
            <div class="mobile-search">
                <i class="fa-solid fa-search search-icon"></i>
                <input type="text" id="mobile-search-input" list="mobile-gares-list" placeholder="Rechercher..." autocomplete="off">
                <datalist id="mobile-gares-list"></datalist>
            </div>
        </div>
        
        <!-- ÉTAGE 2 : Barre d'outils avec scroll horizontal -->
        <!-- Deuxième ligne : rangée de boutons défilable horizontalement pour accéder à tous les outils -->
        <div class="mobile-header-bottom">
            <!-- Bouton découvrir : ouvre l'assistant de recommandation de destinations -->
            <button class="mobile-tool-btn" onclick="openDiscoverModal()" title="Découvrir">
                <i class="fa-solid fa-compass"></i>
                <span>Découvrir</span>
            </button>
            <!-- Bouton statistiques : affiche le tableau de bord national -->
            <button class="mobile-tool-btn" onclick="document.getElementById('btnStats').click()" title="Stats">
                <i class="fa-solid fa-chart-column"></i>
                <span>Stats</span>
            </button>
            <!-- Bouton de géolocalisation : centre la carte sur ma position GPS -->
            <button class="mobile-tool-btn" onclick="locateUser()" title="Ma position">
                <i class="fa-solid fa-location-arrow"></i>
                <span>Position</span>
            </button>
            <!-- Bouton gare aléatoire : propose une destination surprise -->
            <button class="mobile-tool-btn" onclick="randomGare()" title="Aléatoire">
                <i class="fa-solid fa-dice"></i>
                <span>Random</span>
            </button>
            <!-- Bouton carte IGN : bascule vers la vue topographique -->
            <button class="mobile-tool-btn" onclick="toggleIgnLayer()" title="Carte IGN">
                <i class="fa-solid fa-mountain"></i>
                <span>IGN</span>
            </button>
            <!-- Bouton sélecteur de thème : personnalise les couleurs du site -->
            <button class="mobile-tool-btn" onclick="openThemeSelector()" title="Thème">
                <i class="fa-solid fa-palette"></i>
                <span>Thème</span>
            </button>
            <!-- Bouton de changement de langue : bascule entre français et anglais -->
            <button class="mobile-tool-btn" onclick="switchLangMap()" title="Langue">
                <i class="fa-solid fa-language"></i>
                <span id="mobile-lang-text">FR</span>
            </button>
        </div>
    </div>

    <!-- Conteneur principal de la carte interactive Leaflet -->
    <!-- Zone plein écran où s'afficheront la carte, les marqueurs de gares, les clusters et toutes les interactions -->
    <div id="map"></div>

    <!-- MODAL : Fenêtre de découverte personnalisée -->
    <!-- Permet de filtrer les gares par type d'environnement (mer, montagne, ville, campagne) -->
    <div id="discoverModal" class="discover-modal">
        <!-- Effet visuel de particules flottantes en arrière-plan pour dynamiser l'interface -->
        <div class="discover-particles"></div>
        <!-- Contenu principal de la fenêtre -->
        <div class="discover-content">
            <!-- Bouton de fermeture en haut à droite (icône croix) -->
            <button onclick="closeDiscover()" class="discover-close-btn"><i class="fa-solid fa-xmark"></i></button>
            <!-- En-tête avec icône, titre et description -->
            <div class="discover-header">
                <!-- Grande icône de boussole pour représenter la découverte -->
                <div class="discover-icon-main"><i class="fa-solid fa-compass"></i></div>
                <!-- Titre accrocheur de la fenêtre -->
                <h2 id="discoverTitle" class="discover-title">Envie de partir quelque part ?</h2>
                <!-- Sous-titre explicatif du fonctionnement -->
                <p id="discoverSubtitle" class="discover-subtitle">Choisissez un environnement, le site trouve pour vous les gares les plus écologiques.</p>
            </div>
            <!-- Bouton retour : permet de revenir au choix d'environnement si on a déjà sélectionné une catégorie -->
            <button id="btnBackCat" onclick="resetDiscover()" class="discover-back-btn"><i class="fa-solid fa-arrow-left"></i> Choisir un autre environnement</button>
            
            <!-- Grille de cartes interactives pour sélectionner un type d'environnement -->
            <!-- Chaque carte au clic filtre les gares correspondant à la catégorie choisie -->
            <div id="catGrid" class="cat-grid">
                <!-- Carte MER MÉDITERRANÉE : gares côtières méditerranéennes -->
                <div class="cat-card cat-mer" onclick="showCategory('mer', 'Mer & Plages')">
                    <!-- Fond coloré avec dégradé bleu océan -->
                    <div class="cat-card-bg"></div>
                    <!-- Contenu : icône + texte -->
                    <div class="cat-card-content">
                        <i class="fa-solid fa-umbrella-beach cat-icon"></i>
                        <h3 id="cat-mer">Mer Méditerranée</h3>
                        <!-- Effet de brillance au survol -->
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte OCÉAN ATLANTIQUE : gares côtières atlantiques -->
                <div class="cat-card cat-ocean" onclick="showCategory('ocean', 'Océan & Vagues')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-water cat-icon"></i>
                        <h3 id="cat-ocean">Océan Atlantique</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte MONTAGNE : gares en altitude, stations de ski, zones montagneuses -->
                <div class="cat-card cat-montagne" onclick="showCategory('montagne', 'Montagne & Neige')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-mountain-sun cat-icon"></i>
                        <h3 id="cat-montagne">Montagne</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte GRANDES VILLES : métropoles urbaines (Lyon, Marseille, Lille...) -->
                <div class="cat-card cat-ville" onclick="showCategory('ville', 'Grandes Métropoles')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-city cat-icon"></i>
                        <h3 id="cat-ville">Grandes Villes</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte PARIS : spécifique à la région parisienne -->
                <div class="cat-card cat-paris" onclick="showCategory('paris', 'Capitale')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-tower-broadcast cat-icon"></i>
                        <h3 id="cat-paris">Paris</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte LE SUD : régions du sud de la France (climat ensoleillé) -->
                <div class="cat-card cat-sud" onclick="showCategory('sud', 'Le Sud')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-sun cat-icon"></i>
                        <h3 id="cat-sud">Le Sud</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
                <!-- Carte LE NORD : régions du nord de la France (climat plus frais) -->
                <div class="cat-card cat-nord" onclick="showCategory('nord', 'Le Nord')">
                    <div class="cat-card-bg"></div>
                    <div class="cat-card-content">
                        <i class="fa-solid fa-snowflake cat-icon"></i>
                        <h3 id="cat-nord">Le Nord</h3>
                        <div class="cat-shine"></div>
                    </div>
                </div>
            </div>

            <!-- Conteneur dynamique pour afficher la liste des gares correspondant à la catégorie choisie -->
            <!-- Rempli par JavaScript avec des cartes de gares classées par score écologique -->
            <div id="resultsContainer" class="results-container"></div>
        </div>
    </div>

    <!-- MODAL : Panneau de statistiques nationales -->
    <!-- Affiche un tableau de bord complète avec des données agrégées sur toutes les gares de France -->
    <div id="statsPanel" class="stats-panel stats-panel-enhanced">
        <!-- En-tête du panneau avec titre et bouton de fermeture -->
        <div class="stats-header">
           <!-- Titre du tableau de bord avec icône emoji -->
           <h2 id="stats-title">📊 Tableau de bord national</h2>
           <!-- Bouton croix pour fermer le panneau -->
           <button id="closeStats" class="close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <!-- ANCIENNES STATS (conservées) -->
        <!-- Première section : données moyennes et générales sur l'ensemble des gares analysées -->
        <div class="stats-section">
            <!-- Titre de la section avec icône emoji loupe -->
            <div class="stats-section-title" id="section-analysis">🔍 Analyse des gares</div>
            <!-- Grille de cartes de statistiques organisée en colonnes -->
            <div class="stats-grid">
                <!-- Nombre total de gares analysées dans la base de données -->
                <div class="stat-card"><span class="stat-label" id="lbl-gares">Gares analysées</span><span class="stat-value" id="stat-gares">-</span></div>
                <!-- Score écologique moyen calculé sur toutes les gares (sur 100) -->
                <div class="stat-card"><span class="stat-label" id="lbl-score">Score moyen écolo</span><span class="stat-value" id="stat-score">-</span></div>
                <!-- Pourcentage de gares desservies par TGV (lignes à grande vitesse) -->
                <div class="stat-card"><span class="stat-label" id="lbl-tgv">Part TGV</span><span class="stat-value" id="stat-tgv">-</span></div>
                <!-- Nombre moyen de parkings à vélos à proximité des gares (rayon de 10 min à pied) -->
                <div class="stat-card"><span class="stat-label" id="lbl-velos">Moy. parkings vélos</span><span class="stat-value" id="stat-velos">-</span></div>
                <!-- Nombre moyen de bornes de recharge électrique (IRVE) à proximité -->
                <div class="stat-card"><span class="stat-label" id="lbl-bornes">Moy. bornes IRVE</span><span class="stat-value" id="stat-bornes">-</span></div>
                <!-- Nombre moyen d'aires de covoiturage à proximité -->
                <div class="stat-card"><span class="stat-label" id="lbl-covoit">Moy. aires covoit</span><span class="stat-value" id="stat-covoit">-</span></div>
            </div>
        </div>
        
        <!-- NOUVELLES STATS (8 nouvelles) -->
        <!-- Deuxième section : totaux cumulés à l'échelle nationale pour visualiser l'infrastructure écologique globale -->
        <div class="stats-section">
            <!-- Titre de la section avec icône graphique -->
            <div class="stats-section-title" id="section-totals">📈 Totaux nationaux</div>
            <!-- Grille de cartes avec mise en valeur spéciale (classe stat-highlight) -->
            <div class="stats-grid">
                <!-- Total de tous les parkings vélo répertoriés en France près des gares -->
                <div class="stat-card stat-highlight"><span class="stat-emoji">🚲</span><span class="stat-label" id="lbl-total-velos">Parkings vélo</span><span class="stat-value stat-blue" id="stat-total-velos">-</span></div>
                <!-- Total de tous les points de covoiturage en France près des gares -->
                <div class="stat-card stat-highlight"><span class="stat-emoji">🚗</span><span class="stat-label" id="lbl-total-covoit">Points covoiturage</span><span class="stat-value stat-purple" id="stat-total-covoit">-</span></div>
                <!-- Total de toutes les bornes de recharge électrique IRVE en France près des gares -->
                <div class="stat-card stat-highlight"><span class="stat-emoji">🔌</span><span class="stat-label" id="lbl-total-irve">Bornes IRVE</span><span class="stat-value stat-orange" id="stat-total-irve">-</span></div>
                <!-- Nombre de gares qui ont au moins 1 parking vélo à moins de 10 min à pied -->
                <div class="stat-card stat-highlight"><span class="stat-emoji">🚂</span><span class="stat-label" id="lbl-gares-velo">Gares avec vélo (10min)</span><span class="stat-value stat-green" id="stat-gares-velo">-</span></div>
            </div>
        </div>
        
        <!-- Troisième section : données météorologiques en temps réel -->
        <div class="stats-section">
            <!-- Titre de la section avec icône thermomètre -->
            <div class="stats-section-title" id="section-weather">🌡️ Météo en direct</div>
            <!-- Grille spécifique météo avec 2 colonnes pour comparer chaud/froid -->
            <div class="stats-grid stats-grid-weather">
                <!-- Gare avec la température la plus élevée en France en ce moment -->
                <div class="stat-card stat-weather stat-hot"><span class="stat-emoji">☀️</span><span class="stat-label" id="lbl-hottest">Plus chaud</span><span class="stat-value" id="stat-hottest">-</span></div>
                <!-- Gare avec la température la plus basse en France en ce moment -->
                <div class="stat-card stat-weather stat-cold"><span class="stat-emoji">❄️</span><span class="stat-label" id="lbl-coldest">Plus froid</span><span class="stat-value" id="stat-coldest">-</span></div>
            </div>
        </div>
        
        <!-- Quatrième section : classement des gares par accessibilité vélo -->
        <div class="stats-section">
            <!-- Titre de la section avec icône trophée -->
            <div class="stats-section-title" id="section-ranking">🏆 Classement vélos</div>
            <!-- Grille avec cartes spéciales pour la meilleure et les plus faibles gares -->
            <div class="stats-grid">
                <!-- Gare championne : celle qui a le plus de parkings vélo dans un rayon de 10 min à pied -->
                <div class="stat-card stat-champion"><span class="stat-emoji">🥇</span><span class="stat-label" id="lbl-top-velo">Gare top vélo (10min)</span><span class="stat-value stat-gold" id="stat-top-velo">-</span></div>
                <!-- Nombre de gares sans aucun parking vélo à proximité : alerte écologique -->
                <div class="stat-card stat-alert"><span class="stat-emoji">⚠️</span><span class="stat-label" id="lbl-no-velo">Gares sans vélo (10min)</span><span class="stat-value stat-red" id="stat-no-velo">-</span></div>
            </div>
        </div>
        
        <!-- Pied de page du panneau de statistiques avec option de rafraîchissement manuel -->
        <div class="stats-footer">
            <!-- Message indiquant l'actualisation automatique toutes les 30 secondes -->
            <span id="stats-refresh-text">🔄 Actualisation auto: 30s</span>
            <!-- Bouton pour forcer un rafraîchissement immédiat des données -->
            <button id="btnRefreshStats" class="btn-refresh-stats" onclick="forceRefreshStats()">
                <i class="fa-solid fa-sync"></i>
            </button>
        </div>
    </div>

    <!-- MODAL : Sélecteur de thème visuel -->
    <!-- Permet de basculer entre différents schémas de couleurs pour personnaliser l'interface -->
    <div id="themeSelectorPanel">
        <!-- Option thème par défaut : vert écologique (tons verts et naturels) -->
        <div class="theme-option theme-default" onclick="applyTheme('default')">Eco-Vert</div>
        <!-- Option thème océan : tons bleus et aquéens -->
        <div class="theme-option theme-ocean" onclick="applyTheme('ocean')">Océan</div>
    </div>

    <!-- MODAL : Panneau d'informations écologiques avancées -->
    <!-- Affiche des données environnementales complémentaires pour une gare sélectionnée -->
    <div id="ecoPanelModal">
        <!-- Contenu du panneau -->
        <div class="eco-panel-content">
            <!-- Bouton de fermeture flottant en haut à droite -->
            <button onclick="toggleEcoPanel()" style="float:right; background:transparent; border:none; color:white; font-size:1.5rem; cursor:pointer;"><i class="fa-solid fa-xmark"></i></button>
            <!-- Titre du panneau avec icône feuille -->
            <h2 style="color:var(--primary); margin-top:0;">
                <i class="fa-solid fa-leaf"></i> Informations écologiques avancées
            </h2>
            <!-- Conteneur dynamique rempli par JavaScript avec les données écologiques de la gare -->
            <!-- Affichera : qualité de l'air, observations de biodiversité, arbres urbains, etc. -->
            <div id="ecoDataContainer">
                <!-- Message d'invite par défaut avant sélection d'une gare -->
                <p style="color:#94a3b8;">Sélectionnez une gare sur la carte pour voir ses données écologiques détaillées (qualité de l'air, biodiversité, arbres urbains).</p>
            </div>
        </div>
    </div>

    <!-- SCRIPTS JAVASCRIPT : Bibliothèques externes pour la cartographie -->
    <!-- Bibliothèque Leaflet : moteur principal pour afficher la carte interactive -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Extension MarkerCluster : regroupe automatiquement les marqueurs proches pour éviter la surcharge visuelle -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <!-- Extension MiniMap : affiche une petite carte de navigation dans le coin pour se repérer -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.min.js"></script>
    <!-- Extension EasyPrint : permet d'imprimer ou exporter la carte en image PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-easyprint/2.1.9/bundle.js"></script>
    <!-- Extension OSMBuildings : affiche des bâtiments en 3D sur la carte (fonctionnalité avancée) -->
    <script src="https://cdn.osmbuildings.org/4.1.1/OSMBuildings-Leaflet.js"></script>
    <!-- SCRIPT PRINCIPAL : Logique de la carte et gestion multilingue -->
    <script type="module">
        // Import du fichier de traductions (textes en français et anglais)
        import { NAV_TEXTS } from './js/textes.js';
        // Import du fichier principal de logique applicative (carte, données, scoring)
        import './app.js';
        
        // Variable indiquant la langue actuelle de l'interface (true = français, false = anglais)
        let isFrMap = true;
        // Rendre la variable accessible globalement pour les autres scripts
        window.isFrMap = isFrMap;
        
        // FONCTION : Bascule entre français et anglais
        // Met à jour tous les textes de l'interface (navigation, boutons, modales, statistiques)
        function switchLangMap() {
            // Inverser la langue courante
            isFrMap = !isFrMap;
            window.isFrMap = isFrMap;
            // Log de débogage pour vérifier le changement de langue
            console.log('🔄 switchLangMap() appelé - isFrMap maintenant:', isFrMap);
            // Référence au dictionnaire de traductions
            const t = NAV_TEXTS;
            // Mise à jour des liens de navigation
            document.getElementById('nav-home').innerText = isFrMap ? t.navHome.fr : t.navHome.en;
            document.getElementById('nav-fav').innerText = isFrMap ? t.navFav.fr : t.navFav.en;
            document.getElementById('nav-apropos').innerText = isFrMap ? t.navApropos.fr : t.navApropos.en;
            // Mise à jour du placeholder de la barre de recherche
            document.getElementById('search-input').placeholder = isFrMap ? t.search.fr : t.search.en;
            // Mise à jour du bouton "Découvrir"
            document.getElementById('btn-discover-text').innerText = isFrMap ? t.btnDiscover.fr : t.btnDiscover.en;
            // Mise à jour de la modale de découverte (titre, sous-titre, bouton retour)
            document.getElementById('discoverTitle').innerText = isFrMap ? t.discTitle.fr : t.discTitle.en;
            document.getElementById('discoverSubtitle').innerText = isFrMap ? t.discSub.fr : t.discSub.en;
            document.getElementById('btnBackCat').innerText = isFrMap ? t.btnBack.fr : t.btnBack.en;
            // Mise à jour des noms des catégories d'environnement
            document.getElementById('cat-mer').innerText = isFrMap ? t.catMer.fr : t.catMer.en;
            document.getElementById('cat-ocean').innerText = isFrMap ? t.catOcean.fr : t.catOcean.en;
            document.getElementById('cat-montagne').innerText = isFrMap ? t.catMontagne.fr : t.catMontagne.en;
            document.getElementById('cat-ville').innerText = isFrMap ? t.catVille.fr : t.catVille.en;
            document.getElementById('cat-paris').innerText = isFrMap ? t.catParis.fr : t.catParis.en;
            document.getElementById('cat-sud').innerText = isFrMap ? t.catSud.fr : t.catSud.en;
            document.getElementById('cat-nord').innerText = isFrMap ? t.catNord.fr : t.catNord.en;
            
            // Note: Les boutons du tutoriel et le contenu sont mis à jour par updateAppLanguage() dans app.js
            // pour gérer correctement l'étape courante du tutoriel
            
            // --- UPDATING STATS & LOADER (avec vérification null) ---
            // Récupération des éléments du panneau de statistiques pour traduction
            const loaderMsg = document.getElementById('loader-msg');
            const statsTitle = document.getElementById('stats-title');
            const lblGares = document.getElementById('lbl-gares');
            const lblScore = document.getElementById('lbl-score');
            const lblTgv = document.getElementById('lbl-tgv');
            const lblVelos = document.getElementById('lbl-velos');
            const lblBornes = document.getElementById('lbl-bornes');
            const lblCovoit = document.getElementById('lbl-covoit');
            
            // Mise à jour des textes si les éléments existent (vérification pour éviter les erreurs)
            if (loaderMsg) loaderMsg.innerText = isFrMap ? t.loader.fr : t.loader.en;
            if (statsTitle) statsTitle.innerText = isFrMap ? t.statsTitle.fr : t.statsTitle.en;
            if (lblGares) lblGares.innerText = isFrMap ? t.lblGares.fr : t.lblGares.en;
            if (lblScore) lblScore.innerText = isFrMap ? t.lblScore.fr : t.lblScore.en;
            if (lblTgv) lblTgv.innerText = isFrMap ? t.lblTgv.fr : t.lblTgv.en;
            if (lblVelos) lblVelos.innerText = isFrMap ? t.lblVelos.fr : t.lblVelos.en;
            if (lblBornes) lblBornes.innerText = isFrMap ? t.lblBornes.fr : t.lblBornes.en;
            if (lblCovoit) lblCovoit.innerText = isFrMap ? t.lblCovoit.fr : t.lblCovoit.en;
            
            // --- NOUVELLES STATS (8 nouvelles traductions) ---
            // Récupération des éléments des nouvelles sections de statistiques avancées
            const sectionAnalysis = document.getElementById('section-analysis');
            const sectionTotals = document.getElementById('section-totals');
            const sectionWeather = document.getElementById('section-weather');
            const sectionRanking = document.getElementById('section-ranking');
            const lblTotalVelos = document.getElementById('lbl-total-velos');
            const lblTotalCovoit = document.getElementById('lbl-total-covoit');
            const lblTotalIrve = document.getElementById('lbl-total-irve');
            const lblGaresVelo = document.getElementById('lbl-gares-velo');
            const lblHottest = document.getElementById('lbl-hottest');
            const lblColdest = document.getElementById('lbl-coldest');
            const lblTopVelo = document.getElementById('lbl-top-velo');
            const lblNoVelo = document.getElementById('lbl-no-velo');
            const statsRefresh = document.getElementById('stats-refresh-text');
            
            // Mise à jour des titres de section et étiquettes des nouvelles statistiques
            if (sectionAnalysis) sectionAnalysis.innerText = isFrMap ? t.sectionAnalysis.fr : t.sectionAnalysis.en;
            if (sectionTotals) sectionTotals.innerText = isFrMap ? t.sectionTotals.fr : t.sectionTotals.en;
            if (sectionWeather) sectionWeather.innerText = isFrMap ? t.sectionWeather.fr : t.sectionWeather.en;
            if (sectionRanking) sectionRanking.innerText = isFrMap ? t.sectionRanking.fr : t.sectionRanking.en;
            if (lblTotalVelos) lblTotalVelos.innerText = isFrMap ? t.lblTotalVelos.fr : t.lblTotalVelos.en;
            if (lblTotalCovoit) lblTotalCovoit.innerText = isFrMap ? t.lblTotalCovoit.fr : t.lblTotalCovoit.en;
            if (lblTotalIrve) lblTotalIrve.innerText = isFrMap ? t.lblTotalIrve.fr : t.lblTotalIrve.en;
            if (lblGaresVelo) lblGaresVelo.innerText = isFrMap ? t.lblGaresVelo.fr : t.lblGaresVelo.en;
            if (lblHottest) lblHottest.innerText = isFrMap ? t.lblHottest.fr : t.lblHottest.en;
            if (lblColdest) lblColdest.innerText = isFrMap ? t.lblColdest.fr : t.lblColdest.en;
            if (lblTopVelo) lblTopVelo.innerText = isFrMap ? t.lblTopVelo.fr : t.lblTopVelo.en;
            if (lblNoVelo) lblNoVelo.innerText = isFrMap ? t.lblNoVelo.fr : t.lblNoVelo.en;
            if (statsRefresh) statsRefresh.innerText = isFrMap ? t.statsRefresh.fr : t.statsRefresh.en;

            // Déclenchement de l'actualisation de la langue dans app.js pour les autres éléments
            if (window.updateAppLanguage) window.updateAppLanguage(isFrMap);
        }
        
        // Rendre la fonction accessible globalement pour qu'elle soit appelée par les boutons HTML
        window.switchLangMap = switchLangMap;
    </script>
    
    <!-- Script Mobile Adaptive UI -->
    <!-- SCRIPT MOBILE : Gère le comportement spécifique aux petits écrans (menu hamburger, tactile...) -->
    <script src="mobile-logic.js"></script>
</body>
</html>