<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-Escapade |
Tableau de Bord</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="red-alert" id="redAlert"></div>
    <div id="countdown-screen"></div>
    <div class="dashboard-header">
        <div class="brand"><h1>Eco-Escapade</h1></div>
        <div class="nav-links">
            <a href="index.html">Accueil</a>
            <a href="map.html" id="nav-carte">Carte</a>
            <a href="apropos.html" id="nav-about">À propos</a>
            <a href="#" class="active" id="nav-aide" onclick="openOnboarding(); return false;">Aide</a>
        </div>
        <button class="lang-switch" onclick="switchLangCarnet()">FR / EN</button>
    </div>
    <div class="container" style="margin-top: 120px;">
        <div class="top-section">
            <div class="titles"><h2 id="main-title" style="font-size: 
2.5rem; margin: 0;">Tableau de Bord</h2><p id="main-subtitle" style="color:#94a3b8; margin-top: 5px;">Gérez vos futures aventures bas carbone.</p></div>
            <div class="heatmap-container"><div id="miniMap"></div></div>
        </div>
        <div id="grid" class="card-grid"></div>
        <div id="empty" style="text-align: center;
color: #64748b; margin-top: 100px; display: none;"><i class="fa-solid fa-ghost" style="font-size: 3rem; margin-bottom: 20px;"></i><p id="empty-text">Aucune donnée.</p><a href="map.html" id="btn-scan" class="btn-main" style="width:200px;
margin: 20px auto;">Scanner la carte</a></div>
        <div class="danger-zone"><button id="btn-nuke" class="btn-nuke" onclick="openNukeModal()">💥 SÉQUENCE D'AUTODESTRUCTION</button></div>
    </div>
    <button id="vs-btn" onclick="openVsModal()"><i class="fa-solid fa-gavel"></i> <span id="btn-compare">COMPARER</span></button>
    <div id="toast" class="toast"><i class="fa-solid fa-circle-info" style="color:var(--primary)"></i><span id="toast-msg">Message</span></div>
    <div id="onboardingModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 id="onb-title" style="color:var(--primary); font-size:1.8rem; margin-bottom:20px;">Bienvenue dans votre carnet de voyage !</h3>
            <div id="onb-text" style="text-align:left; line-height:1.8; color:#cbd5e1; display: flex; flex-direction: column; gap: 15px;">
                <div style="display: flex; gap: 12px;">
                    <i class="fa-solid fa-gavel" style="color: var(--primary); font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;"></i>
                    <span><strong style="color: white;">Comparez 2 gares</strong> — Sélectionnez deux favoris pour voir leurs scores côte à côte</span>
                </div>
                <div style="display: flex; gap: 12px;">
                    <i class="fa-brands fa-wikipedia-w" style="color: #3b82f6; font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;"></i>
                    <span><strong style="color: white;">Explorez les villes</strong> — Accédez aux images Wikipedia pour découvrir chaque destination</span>
                </div>
                <div style="display: flex; gap: 12px;">
                    <i class="fa-solid fa-qrcode" style="color: #f59e0b; font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;"></i>
                    <span><strong style="color: white;">Générez un QR Code</strong> — Partagez facilement vos gares préférées via code scannable</span>
                </div>
                <div style="display: flex; gap: 12px;">
                    <i class="fa-solid fa-map-location-dot" style="color: #10b981; font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;"></i>
                    <span><strong style="color: white;">Visualisez la carte</strong> — Voyez tous vos favoris en temps réel sur la mini-carte heatmap</span>
                </div>
                <div style="display: flex; gap: 12px;">
                    <i class="fa-solid fa-trash-alt" style="color: #ef4444; font-size: 1.3rem; flex-shrink: 0; margin-top: 2px;"></i>
                    <span><strong style="color: white;">Gérez vos favoris</strong> — Supprimez individuellement ou lancez une séquence d'autodestruction complète</span>
                </div>
            </div>
            <button id="onb-btn" class="btn-main" onclick="closeAll()" style="margin-top:30px; width: 100%; background: var(--primary); color: #022c22; font-weight: 800; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1rem;">Commencer l'exploration !</button>
        </div>
    </div>
    <div id="googlePhotosModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="google-title" id="google-title" style="margin-bottom:10px; font-size:1.6rem; color:var(--primary); display:flex; align-items:center; gap:12px;"><i class="fa-brands fa-wikipedia-w"></i> <span id="google-title-text">Images de la ville</span></h3>
            <p id="googleQuery" style="color:#94a3b8; margin-bottom:20px; font-style:italic; font-size:0.95rem;"></p>
            <div class="google-grid" id="googleGrid"><div style="color:#94a3b8; padding:20px;"><i class="fa-solid fa-spinner fa-spin"></i></div></div>
        </div>
    </div>
    <div id="qrModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 id="qr-title" style="margin-bottom:20px; font-size:1.6rem; color:var(--primary); display:flex; align-items:center; justify-content:center; gap:10px;"><i class="fa-solid fa-qrcode"></i> <span>Partager</span></h3>
            <div id="qrcode" style="margin: 30px auto; width: 160px; height: 160px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); animation: slideUp 0.5s ease-out;"></div>
            <p id="qr-text" style="font-size:0.95rem; color:#94a3b8; margin-top: 20px; font-style: italic;">
                <i class="fa-solid fa-arrow-up" style="margin-right: 8px;"></i>
                Scannez pour ouvrir Google Maps
            </p>
        </div>
    </div>
    <div id="nukeModal" class="modal-overlay">
        <div class="modal-box" style="border: 2px solid #ef4444; box-shadow: 0 0 60px rgba(239,68,68,0.3), 0 20px 60px rgba(0,0,0,0.4);">
            <i class="fa-solid fa-triangle-exclamation" style="font-size: 3rem; color: #ef4444; margin-bottom: 20px; animation: pulse 2s ease-in-out infinite;"></i>
            <h3 id="nuke-title" style="color: #ef4444; font-size: 1.6rem; margin-bottom: 15px;">ATTENTION</h3>
            <p id="nuke-text" style="color: #cbd5e1; margin-bottom: 25px;">Voulez-vous vraiment détruire tout le carnet ?</p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button id="nuke-no" onclick="closeAll()" style="padding: 12px 28px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Annuler</button>
                <button id="nuke-yes" onclick="startSelfDestruct()" style="padding: 12px 28px; background: #ef4444; border: none; color: white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">OUI, DÉTRUIRE</button>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        #nuke-no:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        #nuke-yes:hover {
            background: #dc2626;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.5);
        }
    </style>
    <div id="deleteSingleModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 id="del-title" style="margin-bottom: 15px; font-size: 1.6rem; color: #ef4444;"><i class="fa-solid fa-trash-alt" style="margin-right: 10px;"></i>Supprimer ce favori ?</h3>
            <p id="del-text" style="color: #94a3b8; margin-bottom: 25px; font-size: 0.95rem;">Cette action est <strong style="color: #ef4444;">irréversible</strong></p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button id="del-no" onclick="closeAll()" style="padding: 12px 28px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Annuler</button>
                <button id="confirmDeleteBtn" style="padding: 12px 28px; background: #ef4444; border: none; color: white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">Supprimer</button>
            </div>
        </div>
    </div>
    
    <style>
        #del-no:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        #confirmDeleteBtn:hover {
            background: #dc2626;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.5);
        }
    </style>
    <div id="vsModal" class="modal-overlay">
        <div class="modal-box" style="max-width: 700px;
background: linear-gradient(145deg, #1e293b, #0f172a);">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h2 id="vs-title" style="color:#f59e0b;
font-style:italic; font-size:2rem; margin-bottom:10px;">COMPARATEUR</h2>
            <div id="vsContent"></div>
        </div>
    </div>

    <script>
        const escapeHTML = (str) => str ? str.replace(/[&<>'"]/g, tag => ({ '&': '&', '<': '<', '>': '>', "'": "'", '"': '"' }[tag])) : '';

        // MODIFIÉ : Variable langue déplacée en haut pour être accessible dans render()
        let isFrCarnet = true;
        
        // Placeholder for DASHBOARD_TEXTS - will be imported by module script
        let DASHBOARD_TEXTS = {};

        let favoris = JSON.parse(localStorage.getItem('eco_favoris')) || [];
        favoris = favoris.map(f => {
            if(f.score 
=== undefined) { 
                f.score = Math.floor(Math.random() * 50 + 50) / 10; 
                f.details = { velos: Math.floor(Math.random()*20), bornes: Math.floor(Math.random()*10), covoit: Math.floor(Math.random()*5) };
            }
            return f;
        });

        const grid = document.getElementById('grid');
   
     const empty = document.getElementById('empty');
        let selectedVs = []; 
        let itemToDeleteIndex = null;

        function render() {
            if (favoris.length === 0) { empty.style.display = 'block'; grid.innerHTML = '';
return; }
            favoris.sort((a,b) => (b.score||0) - (a.score||0));
grid.innerHTML = '';
            favoris.forEach((fav, index) => {
                const score = fav.score !== undefined ? fav.score : '?';
                const details = fav.details || { velos: 0, bornes: 0, covoit: 0 };
                let color = '#ef4444'; if(score >= 5) color = '#f59e0b'; if(score >= 8) color = '#10b981';
          
       const deg = (score !== '?' ? score : 0) * 36;
                const gradient = `conic-gradient(${color} ${deg}deg, #334155 0deg)`;
                const safeName = escapeHTML(fav.nom);
                
                // Générer une image background lazy par ville
                const cityName = fav.nom.split(' - ')[0].replace(/Gare de\s?/gi, '').trim();
                const bgImage = `https://images.unsplash.com/photo-${['1488646953014-85cb44e25828', '1555881286-65ee0487213f', '1508062a4a20-7c4a6e6e0f5e'][index % 3]}?w=500&q=40`;

                const div = document.createElement('div');
                div.className = 'card';
                div.style.backgroundImage = `url('${bgImage}')`;
                div.style.backgroundSize = 'cover';
                div.style.backgroundPosition = 'center';
                div.style.backgroundAttachment = 'fixed';
     
           div.innerHTML = `
                    <input type="checkbox" id="chk-${index}" class="vs-checkbox-input" onchange="toggleVs(${index}, this)">
                    <label for="chk-${index}" class="vs-label"><i class="fa-solid fa-check"></i></label>
                    <div class="card-top"><div><span class="badge ${fav.type}">${fav.type}</span><h3>${safeName}</h3></div></div>
               
     <div class="score-row">
                        <div class="circle-wrap" style="background: ${gradient}"><div class="circle-inner">${score}</div></div>
                        <div class="stats-list">
                            <div class="stat-item"><i class="fa-solid fa-bicycle" style="color:#06b6d4;
width:20px;"></i> ${details.velos} ${isFrCarnet ? 'Vélos' : 'Bikes'}</div>
                            <div class="stat-item"><i class="fa-solid fa-plug" style="color:#f59e0b;
width:20px;"></i> ${details.bornes} ${isFrCarnet ? 'Bornes' : 'Terminals'}</div>
                            <div class="stat-item"><i class="fa-solid fa-car" style="color:#a855f7;
width:20px;"></i> ${details.covoit} ${isFrCarnet ? 'Covoit' : 'Carpool'}</div>
                        </div>
                    </div>
                    <a href="map.html?target=${fav.id}" class="btn-main"><i class="fa-solid fa-location-arrow"></i> <span class="txt-go">Y aller</span></a>
                    <div class="tools-grid">
      
                   <button class="tool-btn google" title="${isFrCarnet?'Photos':'Photos'}" onclick="openGooglePhotos('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-image"></i></button>
                        <button class="tool-btn" title="${isFrCarnet?'Google Maps':'Google Maps'}" onclick="openGoogleMaps('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-map-location-dot"></i></button>
                        <button class="tool-btn" title="${isFrCarnet?'QR Code':'QR Code'}" onclick="openQr('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-qrcode"></i></button>
             
           <button class="tool-btn del" title="${isFrCarnet?'Supprimer':'Delete'}" onclick="askDelete(${index})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
                
                // Lazy load intersection observer
                if ('IntersectionObserver' in window) {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = new Image();
                                img.onload = () => {
                                    entry.target.style.backgroundImage = `url('${bgImage}')`;
                                    observer.unobserve(entry.target);
                                };
                                img.src = bgImage;
                            }
                        });
                    });
                    observer.observe(div);
                }
                
grid.appendChild(div);
            });
        }
        render();
if(favoris.length > 0) {
            setTimeout(() => {
                const miniMap = L.map('miniMap', { zoomControl:false, attributionControl:false }).setView([46.5, 2.5], 4);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(miniMap);
                favoris.forEach(f => {
                    const lat = 46 
+ (Math.random()-0.5)*5; 
                    const lon = 2 + (Math.random()-0.5)*5;
                    L.circleMarker([lat, lon], { radius:4, color:'#ef4444', fillOpacity:1, stroke:false }).addTo(miniMap);
                });
            }, 500);
}

        function showToast(msg) {
            const t = document.getElementById('toast');
document.getElementById('toast-msg').innerText = msg;
            t.classList.add('visible');
            setTimeout(() => t.classList.remove('visible'), 3000);
        }
        function closeAll() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
}
        function openModal(id) { document.getElementById(id).classList.add('active');
}

        async function openGooglePhotos(nom) {
            let cleanCity = nom.split(' - ')[0].replace(/Gare de\s?/gi, '').replace(/TGV/gi, '').replace(/Centre/gi, '').trim();
            document.getElementById('googleQuery').innerText = `${isFrCarnet ? 'Recherche pour :' : 'Search for:'} "${cleanCity}"`;
            openModal('googlePhotosModal');
            const grid = document.getElementById('googleGrid');
            grid.innerHTML = `<div style="color:#94a3b8; padding:20px;"><i class="fa-solid fa-spinner fa-spin"></i> ${isFrCarnet ? DASHBOARD_TEXTS.imgLoad.fr : DASHBOARD_TEXTS.imgLoad.en}</div>`;
            
            try {
                // Essayer d'abord en français
                let url = `https://fr.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(cleanCity)}&prop=pageimages&format=json&pithumbsize=600&origin=*`;
                let r = await fetch(url);
                let d = await r.json();
                let pages = d.query.pages;
                let pid = Object.keys(pages)[0];
                let imgSrc = null;
                
                if (pid !== "-1" && pages[pid].thumbnail) {
                    imgSrc = pages[pid].thumbnail.source;
                } else {
                    // Fallback: essayer en anglais
                    url = `https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(cleanCity)}&prop=pageimages&format=json&pithumbsize=600&origin=*`;
                    r = await fetch(url);
                    d = await r.json();
                    pages = d.query.pages;
                    pid = Object.keys(pages)[0];
                    
                    if (pid !== "-1" && pages[pid].thumbnail) {
                        imgSrc = pages[pid].thumbnail.source;
                    }
                }
                
                if (imgSrc) {
                    grid.innerHTML = `<img src="${imgSrc}" class="google-pic" alt="${cleanCity}" onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80'">`;
                } else {
                    // Fallback: image par défaut
                    grid.innerHTML = `<img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80" class="google-pic" alt="${cleanCity}">`;
                }
            } catch(e) {
                console.error('Erreur lors du chargement des images:', e);
                grid.innerHTML = `<img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80" class="google-pic" alt="${cleanCity}">`;
            }
        }

        // FIX: Removed extra "$" before template interpolation which produced malformed URLs
        window.openGoogleMaps = (nom) => { window.open(`https://www.google.com/maps/search/?api=1&query=Gare+${encodeURIComponent(nom.replace(/Gare de\s?/gi, ''))}`);
    };
        window.openQr = (nom) => {
            const container = document.getElementById('qrcode');
container.innerHTML = '';
            // FIX: QR Code URL must not contain stray "$" before interpolation
            new QRCode(container, { text: `https://www.google.com/maps/search/?api=1&query=Gare+${encodeURIComponent(nom)}`, width: 128, height: 128 });
            openModal('qrModal');
        };
window.askDelete = (index) => { itemToDeleteIndex = index; openModal('deleteSingleModal'); };
document.getElementById('confirmDeleteBtn').onclick = () => {
            if(itemToDeleteIndex !== null) {
                favoris.splice(itemToDeleteIndex, 1);
localStorage.setItem('eco_favoris', JSON.stringify(favoris));
                // MODIFIɉ : Toast traduit
                render(); closeAll(); showToast(isFrCarnet ? DASHBOARD_TEXTS.toastDel.fr : DASHBOARD_TEXTS.toastDel.en);
            }
        };
window.toggleVs = (index, checkbox) => {
            if (checkbox.checked) {
                if (selectedVs.length >= 2) { checkbox.checked = false;
// MODIFIɉ : Toast traduit
showToast(isFrCarnet ? DASHBOARD_TEXTS.toastMax.fr : DASHBOARD_TEXTS.toastMax.en); return; }
                selectedVs.push(index);
} else {
                selectedVs = selectedVs.filter(i => i !== index);
}
            const btn = document.getElementById('vs-btn');
if (selectedVs.length === 2) btn.classList.add('visible');
            else btn.classList.remove('visible');
        };

        window.openVsModal = () => {
            const f1 = favoris[selectedVs[0]];
const f2 = favoris[selectedVs[1]];
            const winner = (v1, v2) => v1 > v2 ?
'val-win' : (v1 < v2 ? 'val-lose' : '');
            
            // MODIFIɉ : Labels dynamiques pour la modale VS
            const lblScore = isFrCarnet ? "SCORE GLOBAL" : "GLOBAL SCORE";
            const lblVelos = isFrCarnet ? "V�LOS" : "BIKES";
            const lblBornes = isFrCarnet ? "BORNES" : "TERMINALS";
            const lblCovoit = isFrCarnet ? "COVOIT'" : "CARPOOL";

            document.getElementById('vsContent').innerHTML = `
                <table class="vs-table">
                    <thead><tr><th style="width:40%; font-size:1.1rem; color:white;">${escapeHTML(f1.nom)}</th><th style="width:20%;">VS</th><th style="width:40%; font-size:1.1rem; color:white;">${escapeHTML(f2.nom)}</th></tr></thead>
                    <tbody>
                        <tr><td 
class="${winner(f1.score, f2.score)}" style="font-size:1.5rem;">${f1.score}</td><td style="color:#94a3b8; font-size:0.8rem;">${lblScore}</td><td class="${winner(f2.score, f1.score)}" style="font-size:1.5rem;">${f2.score}</td></tr>
                        <tr><td class="${winner(f1.details.velos, f2.details.velos)}">${f1.details.velos}</td><td style="color:#94a3b8; font-size:0.8rem;">${lblVelos}</td><td class="${winner(f2.details.velos, f1.details.velos)}">${f2.details.velos}</td></tr>
                        <tr><td class="${winner(f1.details.bornes, f2.details.bornes)}">${f1.details.bornes}</td><td style="color:#94a3b8;
font-size:0.8rem;">${lblBornes}</td><td class="${winner(f2.details.bornes, f1.details.bornes)}">${f2.details.bornes}</td></tr>
                        <tr><td class="${winner(f1.details.covoit, f2.details.covoit)}">${f1.details.covoit}</td><td style="color:#94a3b8;
font-size:0.8rem;">${lblCovoit}</td><td class="${winner(f2.details.covoit, f1.details.covoit)}">${f2.details.covoit}</td></tr>
                    </tbody>
                </table>
            `;
            openModal('vsModal');
        };

        window.openNukeModal = () => document.getElementById('nukeModal').classList.add('active');
        window.startSelfDestruct = () => {
      
      closeAll();
            document.body.classList.add('shaking'); document.getElementById('redAlert').classList.add('active'); 
            const screen = document.getElementById('countdown-screen');
            screen.style.display = 'flex';
            let count = 5; screen.innerHTML = count;
            const timer = setInterval(() => {
                
count--; screen.innerHTML = count;
                // MODIFIɉ : Traduction PURGE COMPLETE
                if(count <= 0) { clearInterval(timer); screen.innerHTML = isFrCarnet ? "PURGE TERMIN�E" : "PURGE COMPLETE"; localStorage.removeItem('eco_favoris'); setTimeout(() => location.reload(), 2000); } // FIX: Changed French text for better localization.
            }, 1000);
        };
window.openOnboarding = () => document.getElementById('onboardingModal').classList.add('active');
        if(!localStorage.getItem('visited_carnet_final')) { setTimeout(openOnboarding, 1000); localStorage.setItem('visited_carnet_final', 'true');
}
        
        // Initialiser les traductions au chargement
        document.addEventListener('DOMContentLoaded', () => {
            if (window.switchLangCarnet) {
                // Forcer une mise à jour pour initialiser les textes corrects
                isFrCarnet = true;
                switchLangCarnet();
                isFrCarnet = false;
                switchLangCarnet();
            }
        });
    </script>
    
    <script type="module">
        import { DASHBOARD_TEXTS as DT } from './js/textes.js';
        
        // Make DASHBOARD_TEXTS available globally for the non-module script
        window.DASHBOARD_TEXTS = DT;

        function switchLangCarnet() {
            isFrCarnet = !isFrCarnet;
            const t = window.DASHBOARD_TEXTS;
            document.getElementById('nav-carte').innerText = isFrCarnet ? t.navCarte.fr : t.navCarte.en;
            document.getElementById('nav-aide').innerText = isFrCarnet ? t.navAide.fr : t.navAide.en;
            document.getElementById('main-title').innerText = isFrCarnet ? t.mainTitle.fr : t.mainTitle.en;
            document.getElementById('main-subtitle').innerText = isFrCarnet ? t.mainSub.fr : t.mainSub.en;
            document.getElementById('empty-text').innerText = isFrCarnet ? t.emptyText.fr : t.emptyText.en;
            document.getElementById('btn-scan').innerText = isFrCarnet ? t.btnScan.fr : t.btnScan.en;
            document.getElementById('btn-nuke').innerText = isFrCarnet ? t.btnNuke.fr : t.btnNuke.en;
            document.getElementById('btn-compare').innerText = isFrCarnet ? t.btnCompare.fr : t.btnCompare.en;
            document.getElementById('onb-title').innerText = isFrCarnet ? t.onbTitle.fr : t.onbTitle.en;
            document.getElementById('onb-text').innerText = isFrCarnet ? t.onbText.fr : t.onbText.en;
            document.getElementById('onb-btn').innerText = isFrCarnet ? t.onbBtn.fr : t.onbBtn.en;
            document.getElementById('google-title').innerHTML = '<i class="fa-brands fa-wikipedia-w"></i> ' + (isFrCarnet ? t.googleTitle.fr : t.googleTitle.en);
            document.getElementById('qr-title').innerText = isFrCarnet ? t.qrTitle.fr : t.qrTitle.en;
            document.getElementById('qr-text').innerText = isFrCarnet ? t.qrText.fr : t.qrText.en;
            document.getElementById('nuke-title').innerText = isFrCarnet ? t.nukeTitle.fr : t.nukeTitle.en;
            document.getElementById('nuke-text').innerText = isFrCarnet ? t.nukeText.fr : t.nukeText.en;
            document.getElementById('nuke-no').innerText = isFrCarnet ? t.nukeNo.fr : t.nukeNo.en;
            document.getElementById('nuke-yes').innerText = isFrCarnet ? t.nukeYes.fr : t.nukeYes.en;
            document.getElementById('del-title').innerText = isFrCarnet ? t.delTitle.fr : t.delTitle.en;
            document.getElementById('del-text').innerText = isFrCarnet ? t.delText.fr : t.delText.en;
            document.getElementById('del-no').innerText = isFrCarnet ? t.delNo.fr : t.delNo.en;
            document.getElementById('confirmDeleteBtn').innerText = isFrCarnet ? t.delYes.fr : t.delYes.en;
            document.getElementById('vs-title').innerText = isFrCarnet ? t.vsTitle.fr : t.vsTitle.en;
            // Re-render cards with new language
            render();
        }
        
        window.switchLangCarnet = switchLangCarnet;
    </script>







