<!-- Déclaration HTML5 : version moderne du langage web -->
<!DOCTYPE html>
<!-- Balise racine avec langue française pour l'accessibilité -->
<html lang="fr">
<head>
    <!-- Encodage UTF-8 : permet d'afficher tous les caractères accentués correctement -->
    <meta charset="UTF-8">
    <!-- Configuration responsive : adaptation automatique aux smartphones et tablettes -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Commentaire explicatif du rôle de cette page -->
    <!-- Page de gestion des gares favorites enregistrées par l'utilisateur -->
    <!-- Titre de l'onglet du navigateur -->
    <title>Eco-Escapade |
Tableau de Bord</title>
    <!-- Police Google Fonts Inter : police moderne et lisible pour tout le texte du tableau de bord -->
    <!-- Plusieurs graisses importées (300=light, 400=normal, 600=semi-bold, 800=extra-bold, 900=black) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <!-- Bibliothèque Font Awesome : fournit toutes les icônes (poubelle, marteau, QR code, vélo...) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bibliothèque Leaflet pour afficher la mini-carte des favoris -->
    <!-- CSS de Leaflet pour le style de la carte interactive -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- JavaScript de Leaflet pour la logique de la carte -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Bibliothèque pour générer des QR codes partageables -->
    <!-- Permet de créer des codes QR pour partager les gares favorites -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Feuille de style principale partagée avec les autres pages -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Alerte rouge affichée lors de la séquence d'autodestruction -->
    <!-- Fond rouge clignotant qui envahit l'écran quand l'utilisateur lance la suppression totale -->
    <div class="red-alert" id="redAlert"></div>
    <!-- Écran de compte à rebours pour l'autodestruction -->
    <!-- Affiche le décompte de 5 à 0 avant la suppression définitive de toutes les données -->
    <div id="countdown-screen"></div>
    <!-- Barre de navigation du haut de page -->
    <!-- Identique aux autres pages pour cohérence de navigation -->
    <div class="dashboard-header">
        <!-- Logo du site -->
        <div class="brand"><h1>Eco-Escapade</h1></div>
        <!-- Liens de navigation vers les autres pages -->
        <div class="nav-links">
            <!-- Lien vers la page d'accueil -->
            <a href="index.html">Accueil</a>
            <!-- Lien vers la carte interactive (élément traduit dynamiquement) -->
            <a href="map.html" id="nav-carte">Carte</a>
            <!-- Lien vers la page à propos -->
            <a href="apropos.html" id="nav-about">À propos</a>
            <!-- Lien aide : ouvre la modale de présentation des fonctionnalités -->
            <!-- return false empêche le comportement par défaut du lien -->
            <a href="#" id="nav-aide" onclick="openOnboarding(); return false;">Aide</a>
        </div>
        <!-- Bouton de changement de langue FR/EN -->
        <button class="lang-switch" onclick="switchLangCarnet()">FR / EN</button>
    </div>
    <!-- Conteneur principal du tableau de bord -->
    <!-- margin-top: 120px : espace pour ne pas être masqué par la barre de navigation fixe -->
    <div class="container" style="margin-top: 120px;">
        <!-- Section supérieure avec titre et mini-carte de chaleur des favoris -->
        <!-- Affiche le titre de la page + une carte géographique montrant où sont les gares favorites -->
        <div class="top-section">
            <!-- Zone de titres -->
            <div class="titles">
                <!-- Titre principal du tableau de bord (traduit dynamiquement) -->
                <h2 id="main-title" style="font-size: 
2.5rem; margin: 0;">Tableau de Bord</h2>
                <!-- Sous-titre explicatif (traduit dynamiquement) -->
                <p id="main-subtitle" style="color:#94a3b8; margin-top: 5px;">Gérez vos futures aventures bas carbone.</p>
            </div>
            <!-- Mini-carte montrant la répartition géographique des favoris -->
            <!-- Affiche une carte Leaflet miniature avec des points rouges pour chaque gare favorite -->
            <div class="heatmap-container"><div id="miniMap"></div></div>
        </div>
        <!-- Grille contenant toutes les cartes de gares favorites -->
        <!-- Remplie dynamiquement par JavaScript avec les gares enregistrées dans localStorage -->
        <div id="grid" class="card-grid"></div>
        <!-- Message affiché si aucune gare n'est enregistrée -->
        <!-- Apparaît uniquement quand le localStorage est vide (aucun favori) -->
        <!-- display: none par défaut, devient visible si favoris.length === 0 -->
        <div id="empty" style="text-align: center;
color: #64748b; margin-top: 100px; display: none;">
            <!-- Icône fantôme pour illustrer le vide -->
            <i class="fa-solid fa-ghost" style="font-size: 3rem; margin-bottom: 20px;"></i>
            <!-- Message "Aucune donnée" (traduit dynamiquement) -->
            <p id="empty-text">Aucune donnée.</p>
            <!-- Bouton pour retourner à la carte et ajouter des favoris -->
            <a href="map.html" id="btn-scan" class="btn-main" style="width:200px;
margin: 20px auto;">Scanner la carte</a>
        </div>
        <!-- Bouton pour supprimer toutes les données enregistrées -->
        <!-- Zone de danger : action irréversible qui efface tout le localStorage -->
        <div class="danger-zone">
            <!-- Bouton rouge avec emoji explosion : déclenche la séquence d'autodestruction -->
            <button id="btn-nuke" class="btn-nuke" onclick="openNukeModal()">💥 SÉQUENCE D'AUTODESTRUCTION</button>
        </div>
    </div>
    <!-- Bouton flottant pour comparer deux gares côte à côte -->
    <button id="vs-btn" onclick="openVsModal()"><i class="fa-solid fa-gavel"></i> <span id="btn-compare">COMPARER</span></button>
    <!-- Notification temporaire pour informer l'utilisateur -->
    <div id="toast" class="toast"><i class="fa-solid fa-circle-info" style="color:var(--primary)"></i><span id="toast-msg">Message</span></div>
    <!-- Fenêtre modale de présentation des fonctionnalités -->
    <div id="onboardingModal" class="modal-overlay">
        <div class="modal-box" style="max-width: 600px; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(16, 185, 129, 0.2); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(16, 185, 129, 0.1);">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="display: inline-block; background: linear-gradient(135deg, var(--primary), #059669); padding: 20px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);">
                    <i class="fa-solid fa-map-marked-alt" style="color: #022c22; font-size: 3rem;"></i>
                </div>
                <h3 id="onb-title" style="color: white; font-size: 2rem; margin-bottom: 10px; font-weight: 900; text-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);">Bienvenue dans votre carnet de voyage !</h3>
                <p id="onb-subtitle" style="color: #94a3b8; font-size: 1rem;">Découvrez toutes les fonctionnalités de votre tableau de bord</p>
            </div>
            
            <div id="onb-text" style="text-align: left; line-height: 1.8; color: #cbd5e1; display: flex; flex-direction: column; gap: 16px; margin-bottom: 30px;">
                <div style="display: flex; gap: 15px; padding: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border-radius: 12px; border-left: 4px solid var(--primary); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 6px 12px rgba(16, 185, 129, 0.2)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                    <div style="background: var(--primary); width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fa-solid fa-gavel" style="color: #022c22; font-size: 1.4rem;"></i>
                    </div>
                    <div>
                        <strong id="onb-item1-title" style="color: white; font-size: 1.05rem; display: block; margin-bottom: 4px;">Comparez 2 gares</strong>
                        <span id="onb-item1-desc" style="color: #94a3b8; font-size: 0.95rem;">Sélectionnez deux favoris pour voir leurs scores côte à côte</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; padding: 16px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05)); border-radius: 12px; border-left: 4px solid #3b82f6; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 6px 12px rgba(59, 130, 246, 0.2)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                    <div style="background: #3b82f6; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fa-brands fa-wikipedia-w" style="color: white; font-size: 1.4rem;"></i>
                    </div>
                    <div>
                        <strong id="onb-item2-title" style="color: white; font-size: 1.05rem; display: block; margin-bottom: 4px;">Explorez les villes</strong>
                        <span id="onb-item2-desc" style="color: #94a3b8; font-size: 0.95rem;">Accédez aux images Wikipedia pour découvrir chaque destination</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; padding: 16px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05)); border-radius: 12px; border-left: 4px solid #f59e0b; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 6px 12px rgba(245, 158, 11, 0.2)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                    <div style="background: #f59e0b; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fa-solid fa-qrcode" style="color: white; font-size: 1.4rem;"></i>
                    </div>
                    <div>
                        <strong id="onb-item3-title" style="color: white; font-size: 1.05rem; display: block; margin-bottom: 4px;">Générez un QR Code</strong>
                        <span id="onb-item3-desc" style="color: #94a3b8; font-size: 0.95rem;">Partagez facilement vos gares préférées via code scannable</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; padding: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border-radius: 12px; border-left: 4px solid #10b981; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 6px 12px rgba(16, 185, 129, 0.2)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                    <div style="background: #10b981; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fa-solid fa-map-location-dot" style="color: white; font-size: 1.4rem;"></i>
                    </div>
                    <div>
                        <strong id="onb-item4-title" style="color: white; font-size: 1.05rem; display: block; margin-bottom: 4px;">Visualisez la carte</strong>
                        <span id="onb-item4-desc" style="color: #94a3b8; font-size: 0.95rem;">Voyez tous vos favoris en temps réel sur la mini-carte heatmap</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; padding: 16px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border-radius: 12px; border-left: 4px solid #ef4444; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 6px 12px rgba(239, 68, 68, 0.2)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 6px rgba(0, 0, 0, 0.1)';">
                    <div style="background: #ef4444; width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="fa-solid fa-trash-alt" style="color: white; font-size: 1.4rem;"></i>
                    </div>
                    <div>
                        <strong id="onb-item5-title" style="color: white; font-size: 1.05rem; display: block; margin-bottom: 4px;">Gérez vos favoris</strong>
                        <span style="color: #94a3b8; font-size: 0.95rem;">Supprimez individuellement ou lancez une séquence d'autodestruction complète</span>
                    </div>
                </div>
            </div>
            
            <button id="onb-btn" class="btn-main" onclick="closeAll()" style="margin-top: 10px; width: 100%; background: linear-gradient(135deg, var(--primary), #059669); color: white; font-weight: 900; border: none; padding: 16px 24px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; position: relative; overflow: hidden;">
                <span style="position: relative; z-index: 1; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fa-solid fa-rocket"></i>
                    Commencer l'exploration !
                </span>
            </button>
            
            <style>
                #onb-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 15px 35px rgba(16, 185, 129, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.2);
                }
                #onb-btn:active {
                    transform: translateY(0);
                }
                #onb-btn::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                    transition: left 0.5s ease;
                }
                #onb-btn:hover::before {
                    left: 100%;
                }
            </style>
        </div>
    </div>
    <div id="googlePhotosModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="google-title" id="google-title" style="margin-bottom:10px; font-size:1.6rem; color:var(--primary); display:flex; align-items:center; gap:12px;"><i class="fa-brands fa-wikipedia-w"></i> <span id="google-title-text">Images de la ville</span></h3>
            <p id="googleQuery" style="color:#94a3b8; margin-bottom:20px; font-style:italic; font-size:0.95rem;"></p>
            <div class="google-grid" id="googleGrid"><div style="color:#94a3b8; padding:20px;"><i class="fa-solid fa-spinner fa-spin"></i></div></div>
        </div>
    </div>
    <div id="qrModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 id="qr-title" style="margin-bottom:20px; font-size:1.6rem; color:var(--primary); display:flex; align-items:center; justify-content:center; gap:10px;"><i class="fa-solid fa-qrcode"></i> <span>Partager</span></h3>
            <div id="qrcode" style="margin: 30px auto; width: 160px; height: 160px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); animation: slideUp 0.5s ease-out;"></div>
            <p id="qr-text" style="font-size:0.95rem; color:#94a3b8; margin-top: 20px; font-style: italic;">
                <i class="fa-solid fa-arrow-up" style="margin-right: 8px;"></i>
                Scannez pour ouvrir Google Maps
            </p>
        </div>
    </div>
    <div id="nukeModal" class="modal-overlay">
        <div class="modal-box" style="border: 2px solid #ef4444; box-shadow: 0 0 60px rgba(239,68,68,0.3), 0 20px 60px rgba(0,0,0,0.4);">
            <i class="fa-solid fa-triangle-exclamation" style="font-size: 3rem; color: #ef4444; margin-bottom: 20px; animation: pulse 2s ease-in-out infinite;"></i>
            <h3 id="nuke-title" style="color: #ef4444; font-size: 1.6rem; margin-bottom: 15px;">ATTENTION</h3>
            <p id="nuke-text" style="color: #cbd5e1; margin-bottom: 25px;">Voulez-vous vraiment détruire tout le carnet ?</p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button id="nuke-no" onclick="closeAll()" style="padding: 12px 28px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Annuler</button>
                <button id="nuke-yes" onclick="startSelfDestruct()" style="padding: 12px 28px; background: #ef4444; border: none; color: white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">OUI, DÉTRUIRE</button>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        #nuke-no:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        #nuke-yes:hover {
            background: #dc2626;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.5);
        }
    </style>
    <div id="deleteSingleModal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            <h3 id="del-title" style="margin-bottom: 15px; font-size: 1.6rem; color: #ef4444;"><i class="fa-solid fa-trash-alt" style="margin-right: 10px;"></i>Supprimer ce favori ?</h3>
            <p id="del-text" style="color: #94a3b8; margin-bottom: 25px; font-size: 0.95rem;">Cette action est <strong style="color: #ef4444;">irréversible</strong></p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button id="del-no" onclick="closeAll()" style="padding: 12px 28px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Annuler</button>
                <button id="confirmDeleteBtn" style="padding: 12px 28px; background: #ef4444; border: none; color: white; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);">Supprimer</button>
            </div>
        </div>
    </div>
    
    <style>
        #del-no:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }
        #confirmDeleteBtn:hover {
            background: #dc2626;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.5);
        }
    </style>
    <div id="vsModal" class="modal-overlay">
        <div class="modal-box" style="max-width: 850px; background: #0f172a; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);">
            <button class="close-modal" onclick="closeAll()"><i class="fa-solid fa-xmark"></i></button>
            
            <div style="border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 25px; margin-bottom: 35px;">
                <h2 id="vs-title" style="color: white; font-size: 1.8rem; margin: 0; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;">
                    Comparateur
                </h2>
                <p style="color: #64748b; font-size: 0.9rem; margin-top: 10px;">Analyse comparative des équipements</p>
            </div>
            
            <div id="vsContent"></div>
        </div>
    </div>

    <script>
        const escapeHTML = (str) => str ? str.replace(/[&<>'"]/g, tag => ({ '&': '&', '<': '<', '>': '>', "'": "'", '"': '"' }[tag])) : '';

        // MODIFIÉ : Variable langue déplacée en haut pour être accessible dans render()
        let isFrCarnet = true;
        
        // Placeholder for DASHBOARD_TEXTS - will be imported by module script
        let DASHBOARD_TEXTS = {};
        
        // Cache pour les images preloadées
        let wikiImageCache = {};

        let favoris = JSON.parse(localStorage.getItem('eco_favoris')) || [];
        favoris = favoris.map(f => {
            if(f.score 
=== undefined) { 
                f.score = Math.floor(Math.random() * 50 + 50) / 10; 
                f.details = { velos: Math.floor(Math.random()*20), bornes: Math.floor(Math.random()*10), covoit: Math.floor(Math.random()*5) };
            }
            return f;
        });

        const grid = document.getElementById('grid');
   
     const empty = document.getElementById('empty');
        let selectedVs = []; 
        let itemToDeleteIndex = null;

        function render() {
            if (favoris.length === 0) { empty.style.display = 'block'; grid.innerHTML = '';
return; }
            favoris.sort((a,b) => (b.score||0) - (a.score||0));
grid.innerHTML = '';
            favoris.forEach((fav, index) => {
                const score = fav.score !== undefined ? fav.score : '?';
                const details = fav.details || { velos: 0, bornes: 0, covoit: 0 };
                let color = '#ef4444'; if(score >= 5) color = '#f59e0b'; if(score >= 8) color = '#10b981';
          
       const deg = (score !== '?' ? score : 0) * 36;
                const gradient = `conic-gradient(${color} ${deg}deg, #334155 0deg)`;
                const safeName = escapeHTML(fav.nom);

                const div = document.createElement('div');
                div.className = 'card';
     
           div.innerHTML = `
                    <input type="checkbox" id="chk-${index}" class="vs-checkbox-input" onchange="toggleVs(${index}, this)">
                    <label for="chk-${index}" class="vs-label"><i class="fa-solid fa-check"></i></label>
                    <div class="card-top"><div><span class="badge ${fav.type}">${fav.type}</span><h3>${safeName}</h3></div></div>
               
     <div class="score-row">
                        <div class="circle-wrap" style="background: ${gradient}"><div class="circle-inner">${score}</div></div>
                        <div class="stats-list">
                            <div class="stat-item"><i class="fa-solid fa-bicycle" style="color:#06b6d4;
width:20px;"></i> ${details.velos} ${isFrCarnet ? 'Vélos' : 'Bikes'}</div>
                            <div class="stat-item"><i class="fa-solid fa-plug" style="color:#f59e0b;
width:20px;"></i> ${details.bornes} ${isFrCarnet ? 'Bornes' : 'Terminals'}</div>
                            <div class="stat-item"><i class="fa-solid fa-car" style="color:#a855f7;
width:20px;"></i> ${details.covoit} ${isFrCarnet ? 'Covoit' : 'Carpool'}</div>
                        </div>
                    </div>
                    <a href="map.html?target=${fav.id}" class="btn-main"><i class="fa-solid fa-location-arrow"></i> <span class="txt-go">Y aller</span></a>
                    <div class="tools-grid">
      
                   <button class="tool-btn google" title="${isFrCarnet?'Photos':'Photos'}" onclick="openGooglePhotos('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-image"></i></button>
                        <button class="tool-btn" title="${isFrCarnet?'Google Maps':'Google Maps'}" onclick="openGoogleMaps('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-map-location-dot"></i></button>
                        <button class="tool-btn" title="${isFrCarnet?'QR Code':'QR Code'}" onclick="openQr('${safeName.replace(/'/g, "\\'")}')"><i class="fa-solid fa-qrcode"></i></button>
             
           <button class="tool-btn del" title="${isFrCarnet?'Supprimer':'Delete'}" onclick="askDelete(${index})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
grid.appendChild(div);
            });
            
            // Preload images en arrière-plan après le rendu
            preloadWikipediaImages();
        }
        
        // Fonction pour preloader les images Wikipedia en arrière-plan
        async function preloadWikipediaImages() {
            favoris.forEach((fav) => {
                // Charger silencieusement les images sans afficher
                fetchWikimediaImage(fav.nom).catch(() => {
                    // Erreur silencieuse - ça n'affecte pas l'UX
                });
            });
        }
        
        // Fonction pour chercher une image Wikimedia (utilisée aussi en preload)
        async function fetchWikimediaImage(nom) {
            const cleanName = nom.split(' - ')[0].replace(/Gare de\s?/gi, '').replace(/TGV/gi, '').replace(/Centre/gi, '').trim();
            const villeName = cleanName.split(/[-\s]/)[0];
            
            const searchTerms = [
                `${villeName} gare SNCF`,
                `Gare de ${cleanName}`,
                `${villeName} train station`,
                villeName
            ];
            
            for (const term of searchTerms) {
                try {
                    const url = `https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(term)}&srnamespace=6&srlimit=5&format=json&origin=*`;
                    const r = await fetch(url, { signal: AbortSignal.timeout(5000) });
                    const d = await r.json();
                    
                    if (d.query?.search?.length > 0) {
                        for (const result of d.query.search) {
                            if (/\.(jpg|jpeg|png|gif|webp)$/i.test(result.title)) {
                                const fileName = result.title.replace(/^File:/i, '');
                                return `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(fileName)}?width=500`;
                            }
                        }
                    }
                } catch (e) {
                    continue;
                }
            }
            throw new Error('Pas d\'image trouvée');
        }
        
        render();
if(favoris.length > 0) {
            setTimeout(() => {
                const miniMap = L.map('miniMap', { zoomControl:false, attributionControl:false }).setView([46.5, 2.5], 5);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(miniMap);
                
                const bounds = [];
                favoris.forEach((f, idx) => {
                    // Utiliser les coordonnées réelles si disponibles, sinon générer des positions cohérentes
                    let lat, lon;
                    if (f.lat && f.lon) {
                        lat = f.lat;
                        lon = f.lon;
                    } else {
                        // Générer des coordonnées cohérentes basées sur un hash du nom
                        const hash = f.nom.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                        lat = 43 + (hash % 10); // Entre 43 et 53
                        lon = -2 + (hash % 8);  // Entre -2 et 6
                    }
                    
                    bounds.push([lat, lon]);
                    L.circleMarker([lat, lon], { 
                        radius: 6, 
                        color: '#ef4444', 
                        fillColor: '#ef4444',
                        fillOpacity: 0.9, 
                        weight: 2,
                        stroke: true
                    }).addTo(miniMap);
                });
                
                // Ajuster la vue pour afficher tous les points
                if (bounds.length > 0) {
                    miniMap.fitBounds(bounds, { padding: [30, 30], maxZoom: 6 });
                }
            }, 500);
}

        function showToast(msg) {
            const t = document.getElementById('toast');
document.getElementById('toast-msg').innerText = msg;
            t.classList.add('visible');
            setTimeout(() => t.classList.remove('visible'), 3000);
        }
        function closeAll() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
}
        function openModal(id) { document.getElementById(id).classList.add('active');
}

        async function openGooglePhotos(nom) {
            let cleanCity = nom.split(' - ')[0].replace(/Gare de\s?/gi, '').replace(/TGV/gi, '').replace(/Centre/gi, '').trim();
            const villeName = cleanCity.split(/[-\s]/)[0];
            document.getElementById('googleQuery').innerText = `${isFrCarnet ? 'Recherche pour :' : 'Search for:'} "${cleanCity}"`;
            openModal('googlePhotosModal');
            const grid = document.getElementById('googleGrid');
            
            // Vérifier le cache d'abord
            if (wikiImageCache[villeName]) {
                console.log('✅ Image en cache:', villeName);
                grid.innerHTML = `<img src="${wikiImageCache[villeName]}" class="google-pic" alt="${cleanCity}" onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80'">`;
                return;
            }
            
            grid.innerHTML = `<div style="color:#94a3b8; padding:20px;"><i class="fa-solid fa-spinner fa-spin"></i> ${isFrCarnet ? 'Chargement des images...' : 'Loading images...'}</div>`;
            
            try {
                // Utiliser la fonction fetchWikimediaImage
                const imgSrc = await fetchWikimediaImage(nom);
                // Mettre en cache
                wikiImageCache[villeName] = imgSrc;
                grid.innerHTML = `<img src="${imgSrc}" class="google-pic" alt="${cleanCity}" onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80'">`;
            } catch(e) {
                console.log('Fallback: No Wikimedia image, trying Wikipedia');
                try {
                    const wikiUrl = `https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(villeName)}&prop=pageimages&format=json&pithumbsize=600&origin=*`;
                    const wr = await fetch(wikiUrl);
                    const wd = await wr.json();
                    const wpages = wd.query.pages;
                    const wpid = Object.keys(wpages)[0];
                    
                    if (wpid !== "-1" && wpages[wpid].thumbnail) {
                        const imgSrc = wpages[wpid].thumbnail.source;
                        wikiImageCache[villeName] = imgSrc;
                        grid.innerHTML = `<img src="${imgSrc}" class="google-pic" alt="${cleanCity}" onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80'">`;
                    } else {
                        grid.innerHTML = `<img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80" class="google-pic" alt="${cleanCity}">`;
                    }
                } catch(e2) {
                    grid.innerHTML = `<img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&q=80" class="google-pic" alt="${cleanCity}">`;
                }
            }
        }

        // FIX: Removed extra "$" before template interpolation which produced malformed URLs
        window.openGoogleMaps = (nom) => { window.open(`https://www.google.com/maps/search/?api=1&query=Gare+${encodeURIComponent(nom.replace(/Gare de\s?/gi, ''))}`);
    };
        window.openQr = (nom) => {
            const container = document.getElementById('qrcode');
container.innerHTML = '';
            // FIX: QR Code URL must not contain stray "$" before interpolation
            new QRCode(container, { text: `https://www.google.com/maps/search/?api=1&query=Gare+${encodeURIComponent(nom)}`, width: 128, height: 128 });
            openModal('qrModal');
        };
window.askDelete = (index) => { itemToDeleteIndex = index; openModal('deleteSingleModal'); };
document.getElementById('confirmDeleteBtn').onclick = () => {
            if(itemToDeleteIndex !== null) {
                favoris.splice(itemToDeleteIndex, 1);
localStorage.setItem('eco_favoris', JSON.stringify(favoris));
                // MODIFIɉ : Toast traduit
                render(); closeAll(); showToast(isFrCarnet ? '✅ Favori supprimé' : '✅ Favorite removed');
            }
        };
window.toggleVs = (index, checkbox) => {
            if (checkbox.checked) {
                if (selectedVs.length >= 2) { checkbox.checked = false;
// MODIFI : Toast traduit
showToast(isFrCarnet ? '⚠️ Max 2 sélections' : '⚠️ Max 2 selections'); return; }
                selectedVs.push(index);
} else {
                selectedVs = selectedVs.filter(i => i !== index);
}
            const btn = document.getElementById('vs-btn');
if (selectedVs.length === 2) btn.classList.add('visible');
            else btn.classList.remove('visible');
        };

        window.openVsModal = () => {
            const f1 = favoris[selectedVs[0]];
const f2 = favoris[selectedVs[1]];
            const winner = (v1, v2) => v1 > v2 ?
'val-win' : (v1 < v2 ? 'val-lose' : '');
            
            // Labels dynamiques pour la modale VS
            const lblScore = isFrCarnet ? "Score global" : "Global score";
            const lblVelos = isFrCarnet ? "Vélos" : "Bikes";
            const lblBornes = isFrCarnet ? "Bornes électriques" : "Charging stations";
            const lblCovoit = isFrCarnet ? "Covoiturage" : "Carpool";

            document.getElementById('vsContent').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 35px; align-items: start;">
                    <!-- Gare 1 -->
                    <div>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 24px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(96, 165, 250, 0.15); display: flex; align-items: center; justify-content: center;">
                                    <i class="fa-solid fa-train" style="color: #60a5fa; font-size: 1.1rem;"></i>
                                </div>
                                <h3 style="margin: 0; font-size: 1.05rem; font-weight: 600; color: white; flex: 1;">${escapeHTML(f1.nom)}</h3>
                            </div>
                            <div style="text-align: center; margin-bottom: 25px;">
                                <div style="display: inline-block; width: 90px; height: 90px; border-radius: 50%; background: conic-gradient(#60a5fa ${(f1.score * 36)}deg, rgba(255,255,255,0.06) 0deg); padding: 6px; box-shadow: 0 4px 12px rgba(96, 165, 250, 0.2);">
                                    <div style="width: 100%; height: 100%; border-radius: 50%; background: #0f172a; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                        <div style="font-size: 2rem; font-weight: 900; color: #60a5fa;">${f1.score}</div>
                                        <div style="font-size: 0.75rem; color: #64748b; margin-top: -2px; letter-spacing: 0.5px;">/10</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px;">Score global</div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(6, 182, 212, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-bicycle" style="color: #06b6d4; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblVelos}</span>
                                    </div>
                                    <span class="${winner(f1.details.velos, f2.details.velos)}" style="font-size: 1.2rem; font-weight: 800;">${f1.details.velos}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(245, 158, 11, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-plug" style="color: #f59e0b; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblBornes}</span>
                                    </div>
                                    <span class="${winner(f1.details.bornes, f2.details.bornes)}" style="font-size: 1.2rem; font-weight: 800;">${f1.details.bornes}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(168, 85, 247, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-car" style="color: #a855f7; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblCovoit}</span>
                                    </div>
                                    <span class="${winner(f1.details.covoit, f2.details.covoit)}" style="font-size: 1.2rem; font-weight: 800;">${f1.details.covoit}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VS Divider -->
                    <div style="display: flex; align-items: center; justify-content: center; padding-top: 80px;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: rgba(255, 255, 255, 0.04); border: 2px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                            <span style="font-size: 1.1rem; font-weight: 800; color: #94a3b8; letter-spacing: 1px;">VS</span>
                        </div>
                    </div>
                    
                    <!-- Gare 2 -->
                    <div>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 24px;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="width: 36px; height: 36px; border-radius: 8px; background: rgba(59, 130, 246, 0.15); display: flex; align-items: center; justify-content: center;">
                                    <i class="fa-solid fa-train" style="color: #3b82f6; font-size: 1.1rem;"></i>
                                </div>
                                <h3 style="margin: 0; font-size: 1.05rem; font-weight: 600; color: white; flex: 1;">${escapeHTML(f2.nom)}</h3>
                            </div>
                            <div style="text-align: center; margin-bottom: 25px;">
                                <div style="display: inline-block; width: 90px; height: 90px; border-radius: 50%; background: conic-gradient(#3b82f6 ${(f2.score * 36)}deg, rgba(255,255,255,0.06) 0deg); padding: 6px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);">
                                    <div style="width: 100%; height: 100%; border-radius: 50%; background: #0f172a; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                        <div style="font-size: 2rem; font-weight: 900; color: #3b82f6;">${f2.score}</div>
                                        <div style="font-size: 0.75rem; color: #64748b; margin-top: -2px; letter-spacing: 0.5px;">/10</div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px;">Score global</div>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(6, 182, 212, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-bicycle" style="color: #06b6d4; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblVelos}</span>
                                    </div>
                                    <span class="${winner(f2.details.velos, f1.details.velos)}" style="font-size: 1.2rem; font-weight: 800;">${f2.details.velos}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(245, 158, 11, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-plug" style="color: #f59e0b; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblBornes}</span>
                                    </div>
                                    <span class="${winner(f2.details.bornes, f1.details.bornes)}" style="font-size: 1.2rem; font-weight: 800;">${f2.details.bornes}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 28px; height: 28px; border-radius: 6px; background: rgba(168, 85, 247, 0.15); display: flex; align-items: center; justify-content: center;">
                                            <i class="fa-solid fa-car" style="color: #a855f7; font-size: 0.9rem;"></i>
                                        </div>
                                        <span style="font-size: 0.9rem; color: #cbd5e1; font-weight: 500;">${lblCovoit}</span>
                                    </div>
                                    <span class="${winner(f2.details.covoit, f1.details.covoit)}" style="font-size: 1.2rem; font-weight: 800;">${f2.details.covoit}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            openModal('vsModal');
        };

        window.openNukeModal = () => document.getElementById('nukeModal').classList.add('active');
        window.startSelfDestruct = () => {
      
      closeAll();
            document.body.classList.add('shaking'); document.getElementById('redAlert').classList.add('active'); 
            const screen = document.getElementById('countdown-screen');
            screen.style.display = 'flex';
            let count = 5; screen.innerHTML = count;
            const timer = setInterval(() => {
                
count--; screen.innerHTML = count;
                // MODIFIɉ : Traduction PURGE COMPLETE
                if(count <= 0) { clearInterval(timer); screen.innerHTML = isFrCarnet ? "PURGE TERMIN�E" : "PURGE COMPLETE"; localStorage.removeItem('eco_favoris'); setTimeout(() => location.reload(), 2000); } // FIX: Changed French text for better localization.
            }, 1000);
        };
window.openOnboarding = () => document.getElementById('onboardingModal').classList.add('active');
        if(!localStorage.getItem('visited_carnet_final')) { setTimeout(openOnboarding, 1000); localStorage.setItem('visited_carnet_final', 'true');
}
        
        // Initialiser les traductions au chargement
        document.addEventListener('DOMContentLoaded', () => {
            if (window.switchLangCarnet) {
                // Forcer une mise à jour pour initialiser les textes corrects
                isFrCarnet = true;
                switchLangCarnet();
                isFrCarnet = false;
                switchLangCarnet();
            }
        });
    </script>
    
    <script>
        // Définir la fonction globalement pour éviter les erreurs
        window.switchLangCarnet = function() {};
    </script>
    
    <script type="module">
        import { DASHBOARD_TEXTS as DT } from './js/textes.js';
        
        // Make DASHBOARD_TEXTS available globally for the non-module script
        window.DASHBOARD_TEXTS = DT;

        function switchLangCarnet() {
            isFrCarnet = !isFrCarnet;
            const t = window.DASHBOARD_TEXTS;
            document.getElementById('nav-carte').innerText = isFrCarnet ? t.navCarte.fr : t.navCarte.en;
            document.getElementById('nav-aide').innerText = isFrCarnet ? t.navAide.fr : t.navAide.en;
            document.getElementById('main-title').innerText = isFrCarnet ? t.mainTitle.fr : t.mainTitle.en;
            document.getElementById('main-subtitle').innerText = isFrCarnet ? t.mainSub.fr : t.mainSub.en;
            document.getElementById('empty-text').innerText = isFrCarnet ? t.emptyText.fr : t.emptyText.en;
            document.getElementById('btn-scan').innerText = isFrCarnet ? t.btnScan.fr : t.btnScan.en;
            document.getElementById('btn-nuke').innerText = isFrCarnet ? t.btnNuke.fr : t.btnNuke.en;
            document.getElementById('btn-compare').innerText = isFrCarnet ? t.btnCompare.fr : t.btnCompare.en;
            document.getElementById('onb-title').innerText = isFrCarnet ? t.onbTitle.fr : t.onbTitle.en;
            document.getElementById('onb-subtitle').innerText = isFrCarnet ? t.onbSubtitle.fr : t.onbSubtitle.en;
            document.getElementById('onb-item1-title').innerText = isFrCarnet ? t.onbItem1Title.fr : t.onbItem1Title.en;
            document.getElementById('onb-item1-desc').innerText = isFrCarnet ? t.onbItem1Desc.fr : t.onbItem1Desc.en;
            document.getElementById('onb-item2-title').innerText = isFrCarnet ? t.onbItem2Title.fr : t.onbItem2Title.en;
            document.getElementById('onb-item2-desc').innerText = isFrCarnet ? t.onbItem2Desc.fr : t.onbItem2Desc.en;
            document.getElementById('onb-item3-title').innerText = isFrCarnet ? t.onbItem3Title.fr : t.onbItem3Title.en;
            document.getElementById('onb-item3-desc').innerText = isFrCarnet ? t.onbItem3Desc.fr : t.onbItem3Desc.en;
            document.getElementById('onb-item4-title').innerText = isFrCarnet ? t.onbItem4Title.fr : t.onbItem4Title.en;
            document.getElementById('onb-item4-desc').innerText = isFrCarnet ? t.onbItem4Desc.fr : t.onbItem4Desc.en;
            document.getElementById('onb-item5-title').innerText = isFrCarnet ? t.onbItem5Title.fr : t.onbItem5Title.en;
            document.getElementById('onb-item5-desc').innerText = isFrCarnet ? t.onbItem5Desc.fr : t.onbItem5Desc.en;
            document.getElementById('onb-btn').innerText = isFrCarnet ? t.onbBtn.fr : t.onbBtn.en;
            document.getElementById('google-title').innerHTML = '<i class="fa-brands fa-wikipedia-w"></i> ' + (isFrCarnet ? t.googleTitle.fr : t.googleTitle.en);
            document.getElementById('qr-title').innerText = isFrCarnet ? t.qrTitle.fr : t.qrTitle.en;
            document.getElementById('qr-text').innerText = isFrCarnet ? t.qrText.fr : t.qrText.en;
            document.getElementById('nuke-title').innerText = isFrCarnet ? t.nukeTitle.fr : t.nukeTitle.en;
            document.getElementById('nuke-text').innerText = isFrCarnet ? t.nukeText.fr : t.nukeText.en;
            document.getElementById('nuke-no').innerText = isFrCarnet ? t.nukeNo.fr : t.nukeNo.en;
            document.getElementById('nuke-yes').innerText = isFrCarnet ? t.nukeYes.fr : t.nukeYes.en;
            document.getElementById('del-title').innerText = isFrCarnet ? t.delTitle.fr : t.delTitle.en;
            document.getElementById('del-text').innerText = isFrCarnet ? t.delText.fr : t.delText.en;
            document.getElementById('del-no').innerText = isFrCarnet ? t.delNo.fr : t.delNo.en;
            document.getElementById('confirmDeleteBtn').innerText = isFrCarnet ? t.delYes.fr : t.delYes.en;
            document.getElementById('vs-title').innerText = isFrCarnet ? t.vsTitle.fr : t.vsTitle.en;
            // Re-render cards with new language
            render();
        }
        
        window.switchLangCarnet = switchLangCarnet;
    </script>







